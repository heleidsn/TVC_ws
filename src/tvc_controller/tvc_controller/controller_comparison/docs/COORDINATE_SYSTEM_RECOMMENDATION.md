# 坐标系选择建议

## 当前状态

### Controller Comparison模块
- **LQR控制器（lqr_full_state.py）**：ENU坐标系
- **PID控制器（pid_controller.py）**：ENU坐标系
- **动力学模型（RocketDynamics）**：ENU坐标系

### 原始LQR控制器（lqr_controller_node.py）
- **坐标系**：NED坐标系
- **用途**：PX4集成

## 两种选择对比

### 选择1：统一使用ENU坐标系（当前状态）✅ **推荐**

#### 优点
1. ✅ **公平比较**：LQR和PID使用相同的坐标系，便于公平比较控制性能
2. ✅ **直观性**：Z直接表示高度（Z = 1.0 表示1米高度），更符合直觉
3. ✅ **ROS标准**：符合ROS 2 REP 103标准（Z轴向上）
4. ✅ **代码一致性**：所有控制器和动力学模型使用同一坐标系，减少混淆
5. ✅ **易于调试**：符号和逻辑更直观，减少错误
6. ✅ **便于扩展**：如果未来需要与ROS 2集成，无需坐标转换

#### 缺点
1. ❌ **与原始LQR不一致**：与`lqr_controller_node.py`使用的NED坐标系不同
2. ❌ **参数移植**：如果要从原始LQR移植参数，需要进行坐标转换

#### 适用场景
- ✅ 主要用于控制器性能比较
- ✅ 独立仿真系统
- ✅ 需要直观理解的控制逻辑
- ✅ 未来可能集成ROS 2

---

### 选择2：统一使用NED坐标系

#### 优点
1. ✅ **与原始LQR一致**：与`lqr_controller_node.py`使用的坐标系一致
2. ✅ **参数移植**：可以直接从原始LQR实现移植参数和逻辑
3. ✅ **PX4兼容**：符合PX4标准，便于与PX4系统集成
4. ✅ **航空航天标准**：符合航空航天领域的常见约定

#### 缺点
1. ❌ **不够直观**：Z向下为正（Z = -1.0 表示1米高度），不符合直觉
2. ❌ **需要大量修改**：需要修改RocketDynamics、PID控制器、所有相关代码
3. ❌ **与ROS标准不一致**：不符合ROS 2 REP 103标准
4. ❌ **容易出错**：符号转换容易引入错误
5. ❌ **测试工作量大**：需要重新验证所有控制器的正确性

#### 适用场景
- ✅ 需要与PX4系统直接集成
- ✅ 需要从原始LQR直接移植参数
- ✅ 主要面向航空航天应用

---

## 推荐方案

### **推荐：保持ENU坐标系（当前状态）**

#### 理由

1. **Controller Comparison是独立的仿真系统**
   - 主要目的是比较不同控制器的性能
   - 不直接与PX4系统集成
   - 使用统一的坐标系（ENU）便于公平比较

2. **更直观和易于理解**
   - Z直接表示高度，符合大多数用户的直觉
   - 减少符号混淆和错误
   - 便于调试和验证

3. **符合ROS标准**
   - 如果未来需要与ROS 2集成，无需坐标转换
   - 符合机器人学领域的常见约定

4. **代码一致性**
   - 所有控制器（LQR和PID）使用相同的坐标系
   - 动力学模型统一使用ENU
   - 减少代码维护成本

5. **如果需要与PX4集成**
   - 可以在接口层进行坐标转换
   - 不需要修改核心控制逻辑
   - 保持仿真系统的独立性

---

## 如果需要与原始LQR对齐

如果确实需要与原始LQR控制器（NED坐标系）对齐，可以考虑以下方案：

### 方案A：在接口层转换（推荐）

保持Controller Comparison使用ENU，但在需要时进行坐标转换：

```python
def enu_to_ned_for_lqr(state_enu):
    """Convert ENU state to NED for LQR comparison"""
    state_ned = state_enu.copy()
    state_ned[2] = -state_enu[2]  # Z: Up -> Down
    state_ned[5] = -state_enu[5]  # vz: Up -> Down
    return state_ned
```

### 方案B：创建NED版本的LQR控制器

创建一个专门用于NED坐标系的LQR控制器，与原始实现对齐：

```python
class LQRFullStateControllerNED:
    """NED版本的LQR控制器，与原始lqr_controller_node.py对齐"""
    # 使用NED坐标系的线性化模型
    # 控制律：u_lqr[2] - mg（从输出中减去平衡推力）
```

---

## 总结

| 方面 | ENU（当前） | NED |
|------|------------|-----|
| **比较公平性** | ✅ 相同坐标系 | ✅ 相同坐标系 |
| **直观性** | ✅ 非常直观 | ❌ 不够直观 |
| **ROS兼容性** | ✅ 完全兼容 | ❌ 不兼容 |
| **与原始LQR一致** | ❌ 不一致 | ✅ 一致 |
| **代码修改量** | ✅ 无需修改 | ❌ 大量修改 |
| **维护成本** | ✅ 低 | ❌ 高 |
| **推荐度** | ✅✅✅ **强烈推荐** | ⚠️ 仅特殊需求 |

### 最终建议

**保持当前状态（ENU坐标系）**，因为：
1. Controller Comparison是独立的仿真系统，主要用于控制器性能比较
2. 使用统一的坐标系（ENU）便于公平比较LQR和PID
3. 更直观，便于理解和调试
4. 如果需要在PX4中使用，可以在接口层进行坐标转换
